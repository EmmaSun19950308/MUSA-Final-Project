"0","## 1. occupancy data"
"0","occupancy = read.csv(""trains_train.csv"") "
"0",""
"0","## 2. station data"
"0","stations0 <- read.csv(""stations.csv"")"
"0","stations.sf <- "
"0","  stations0 %>% "
"0","  st_as_sf(coords = c(""longitude"", ""latitude""), crs = 4326, agr = ""constant"") %>%"
"0","  st_transform(31370)"
"0",""
"0","stations <- stations.sf %>%"
"0","  separate(URI, c(""res"", ""station_name""), ""NMBS/"")%>%"
"0","  select(station_name,name,country.code,avg_stop_times,"
"0","         geometry)"
"0",""
"0",""
"0","## 3. Weather data"
"0","W701 <- read.csv(""weather_data_july_1.csv"")"
"0","W702 <- read.csv(""weather_data_july_2.csv"")"
"0","W801 <- read.csv(""weather_data_aug_1.csv"")"
"0","W802 <- read.csv(""weather_data_aug_2.csv"")"
"0","W901 <- read.csv(""weather_data_sep_1.csv"")"
"0","W902 <- read.csv(""weather_data_sep_2.csv"")"
"0","W101 <- read.csv(""weather_data_oct_1.csv"")"
"0","W102 <- read.csv(""weather_data_oct_2.csv"")"
"0",""
"0","weather <- rbind(W701,W702,W801,W802,W901,W902,W101,W102) %>%"
"0","  mutate(interval60 = ymd_hms(date_time))"
"0",""
"0",""
"0",""
"0","## 4. Demographic data: population density"
"0","### population"
"0","### https://ec.europa.eu/eurostat/cache/metadata/en/demo_r_gind3_esms.htm"
"0","### topo data"
"0","### https://gisco-services.ec.europa.eu/distribution/v1/nuts-2016.html"
"0","bel <- st_read(""NUTS_RG_60M_2016_4326_LEVL_3.shp"") "
"1","Reading layer `"
"1","NUTS_RG_60M_2016_4326_LEVL_3"
"1","' from data source `"
"1","/Users/penguin/Box Sync/GitHub/Final Project/NUTS_RG_60M_2016_4326_LEVL_3.shp"
"1","' using driver `"
"1","ESRI Shapefile"
"1","'"
"1","
"
"1","Simple feature collection with 1522 features and 9 fields"
"1","
"
"1","geometry type:  MULTIPOLYGON
"
"1","dimension:      XY
"
"1","bbox:           "
"1","xmin: -61.841 ymin: -21.376 xmax: 55.85 ymax: 71.178"
"1","
"
"1","geographic CRS: WGS 84
"
"0","popdens <- read.csv(""demo_r_d2jan_1_Data.csv"")"
"0","belpopden <- bel %>%"
"0","  left_join(dplyr::select(popdens, c(GEO, Value)), by = c(""FID"" = ""GEO"")) %>%"
"0","  st_transform(31370)"
"0",""
"0",""
"0",""
"0","## 5. Facility data"
"0",""
"0","facility <- read.csv(""facilities.csv"")"
"0","facility[is.na(facility)] <- 0 "
"0",""
"0","facility <- "
"0","  facility %>% "
"0","  mutate(facility_sum = select(.,ticket_vending_machine:audio_induction_loop) %>% "
"0","           rowSums()) %>% "
"0","  select(name,facility_sum)"
"0",""
"0","stations <- merge(stations, facility,by.x=""name"",all.x=TRUE) "
"0",""
"0","## 6. Railway data"
"0","### https://mapcruzin.com/free-belgium-arcgis-maps-shapefiles.htm"
"0","rail <- st_read(""belgium-railways-shape/railways.shp"") %>%"
"0","  st_transform(4326)"
"1","Reading layer `"
"1","railways"
"1","' from data source `"
"1","/Users/penguin/Box Sync/GitHub/Final Project/belgium-railways-shape/railways.shp"
"1","' using driver `"
"1","ESRI Shapefile"
"1","'"
"1","
"
"1","Simple feature collection with 3231 features and 3 fields"
"1","
"
"1","geometry type:  LINESTRING
"
"1","dimension:      XY
"
"1","bbox:           "
"1","xmin: 2.558077 ymin: 49.54788 xmax: 6.363977 ymax: 51.45972"
"1","
"
"1","geographic CRS: WGS 84
"
"0","## 7. Line Info"
"0","lines <- read.csv('line_info.csv')"
"0",""
"0",""
"0","# Initial Dataset"
"0",""
"0","data <-"
"0","  occupancy %>%"
"0","  mutate(from = as.character(from), to = as.character(to)) %>%"
"0","  left_join(dplyr::select(stations, station_name), by = c(""from"" = ""station_name"")) %>%"
"0","  st_sf() %>% "
"0","  mutate(from.X = st_coordinates(.)[,1], from.Y = st_coordinates(.)[,2]) %>%"
"0","  st_drop_geometry() %>%"
"0","  left_join(dplyr::select(stations, station_name), by = c(""to"" = ""station_name"")) %>%"
"0","  st_sf() %>% "
"0","  mutate(to.X = st_coordinates(.)[,1], to.Y = st_coordinates(.)[,2]) %>%"
"0","  st_drop_geometry() %>%"
"0","  mutate(distance = sqrt((from.X - to.X)^2 + (from.Y - to.Y)^2)) %>%"
"0","  arrange(-distance) "
"0",""
"0",""
"0","data <- data %>%"
"0","  mutate(datetime <- paste(date,time),"
"0","         datetime = parse_date_time(datetime, '%y-%m-%d %I:%M:%S %p'),"
"0","         interval60 = floor_date(ymd_hms(datetime), unit = ""hour""),"
"0","         interval15 = floor_date(ymd_hms(datetime), unit = ""15 mins""),"
"0","         week = week(interval60),"
"0","         dotw = wday(interval60)) %>%"
"0","  select(-`datetime <- paste(date, time)`)"
"0",""
"0","data <- data %>%"
"0","  mutate(day = case_when("
"0","     dotw==1~""Mon"","
"0","    dotw==2~""Tue"","
"0","    dotw==3~""Wed"","
"0","    dotw==4~""Thu"","
"0","    dotw==5~""Fri"","
"0","    dotw==6~""Sat"","
"0","    dotw==7~""Sun"""
"0","  )) %>%"
"0","  select(-dotw) "
"0",""
"0",""
"0","data$vehicle_type <- gsub(""[^a-zA-Z]"", """", data$vehicle) "
"0","data$vehicle_type[data$vehicle_type==""""] <- ""undefined"""
"0","data$vehicle_type[data$vehicle_type==""ic""] <- ""ICE"""
"0",""
"0","## final data: departure station data"
"0","data_f_0 <-  merge(data, stations,  by.x = ""from"", by.y = ""station_name"",all.x = TRUE) %>%"
"0","   st_as_sf()"
"0",""
"0","data_f_00 <- merge(data_f_0,weather,by.x=c(""name"",""interval60""),by.y=c(""station_name"",""interval60""),all.x = TRUE)"
"0",""
"0",""
"0","## final data: destination station data"
"0","data_t_0 <-  merge(data, stations,  by.x = ""to"", by.y = ""station_name"",all.x = TRUE) %>%"
"0","   st_as_sf()"
"0",""
"0","data_t_00 <- merge(data_t_0,weather,by.x=c(""name"",""interval60""),by.y=c(""station_name"",""interval60""),all.x = TRUE)"
"0",""
