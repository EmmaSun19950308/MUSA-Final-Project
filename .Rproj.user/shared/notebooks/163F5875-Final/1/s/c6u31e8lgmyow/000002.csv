"0","connect <- function(line,stt){"
"0","  stt <- as.data.frame(stt) %>% "
"0","    select(1)"
"0","  stt$connect <- NA"
"0",""
"0","  for(i in seq(1:nrow(stt))){"
"0","    if(length(table(line$stops==stt[i,1]))==2){"
"0","      line_i <- line %>% "
"0","        filter(stops==stt[i,1])"
"0","      stt$connect[i] <- nrow(line_i)"
"0","      }"
"0","    }"
"0","  return(stt)"
"0","}"
"0",""
"0",""
"0","lines_connect <- lines %>% "
"0","  select(5,7) %>% "
"0","  mutate(stops = gsub(""\\["","""",stopping_station_ids)) %>% "
"0","  mutate(stops = gsub(""\\]"","""",stops)) %>% "
"0","  mutate(stops = gsub(""'"",  """",stops)) %>% "
"0","  mutate(stops = gsub("" "",  """",stops)) %>% "
"0","  unique() %>% "
"0","  select(3) %>% "
"0","  separate_rows(stops, sep="","") %>%"
"0","  group_by(stops) %>%"
"0","  summarize(connections = n())"
"0",""
"0","stations_occ_line <- merge(stations_occq, lines_connect, "
"0","                           by.x = ""station_name"", by.y = ""stops"", all.x = TRUE)"
"0",""
"0","stations_final <- merge(st_drop_geometry(stations_copy),"
"0","                        st_drop_geometry(stations_occ_line),"
"0","                        by = ""station_name"") %>%"
"0","  select(-name,-country.code,-avg_stop_times,-facility_sum)"
