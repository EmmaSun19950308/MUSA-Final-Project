"0","neighborList <- knn2nb(knearneigh(st_coordinates(stations), 3))"
"0","occupancy$from <- as.character(occupancy$from)"
"0","occupancy$to <- as.character(occupancy$to)"
"0",""
"0","getnb_from <- function(x,i, from, occ){"
"0","    nbcount = occupancy %>%"
"0","      left_join(dplyr::select(stations_copy, c(station_name, stationsdist)), by = c(from = ""station_name"")) %>%"
"0","      filter(from %in% stations$station_name[neighborList[[i]]]) %>%"
"0","      tally()"
"0","    nbcount1 = occupancy %>%"
"0","      left_join(dplyr::select(stations_copy, c(station_name, stationsdist)), by = c(from = ""station_name"")) %>%"
"0","      filter(from %in% stations$station_name[neighborList[[i]]] & occupancy == occ) %>%"
"0","      tally()"
"0","    nbcount2 = nbcount1/nbcount"
"0","  return(nbcount2[,1])"
"0","}"
"0",""
"0","#avg composition of low occupancy from neighbor from stations"
"0","nblist = list()"
"0","for (i in 1:length(neighborList)){"
"0","  nblist[[i]] = getnb_from(neighborList,i,""from"",""low"")"
"0","}"
